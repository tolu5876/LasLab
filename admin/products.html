<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Manage Products</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #f4f6f9;
      }
      .sidebar {
        min-height: 100vh;
        background: #111;
        color: #fff;
      }
      .sidebar a {
        color: #bbb;
        display: block;
        padding: 12px 20px;
        text-decoration: none;
      }
      .sidebar a:hover,
      .sidebar a.active {
        background: #ff3b3b;
        color: #fff;
      }
      img {
        border-radius: 6px;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- SIDEBAR -->
        <div class="col-md-3 col-lg-2 sidebar p-0">
          <h4 class="text-center py-4 border-bottom">Admin Panel</h4>
          <a href="dashboard.html"
            ><i class="bi bi-speedometer2 me-2"></i> Dashboard</a
          >
          <a href="products.html" class="active"
            ><i class="bi bi-box-seam me-2"></i> Products</a
          >
          <a href="orders.html"><i class="bi bi-bag-check me-2"></i> Orders</a>
          <a href="../index.html"
            ><i class="bi bi-globe me-2"></i> View Website</a
          >
        </div>

        <!-- MAIN -->
        <div class="col-md-9 col-lg-10 p-4">
          <h2 class="mb-4">Products</h2>

          <!-- ADD PRODUCT FORM -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <input
                    type="text"
                    id="name"
                    class="form-control"
                    placeholder="Product Name"
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="number"
                    id="price"
                    class="form-control"
                    placeholder="Price"
                  />
                </div>
                <div class="col-md-4">
                  <input
                    type="file"
                    id="imageFile"
                    class="form-control"
                    accept="image/*"
                    onchange="previewImage(this)"
                  />
                  <img
                    id="imagePreview"
                    src=""
                    width="60"
                    class="mt-2 d-none"
                  />
                </div>
                <div class="col-md-1 d-grid">
                  <button class="btn btn-danger" onclick="addProduct()">
                    Add
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- PRODUCTS TABLE -->
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Price</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="productTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Product</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <input
              type="text"
              id="editName"
              class="form-control mb-2"
              placeholder="Product Name"
            />
            <input
              type="number"
              id="editPrice"
              class="form-control mb-2"
              placeholder="Price"
            />
            <input
              type="file"
              id="editImageFile"
              class="form-control mb-2"
              accept="image/*"
              onchange="previewEditImage(this)"
            />
            <img id="editImagePreview" src="" width="60" class="mt-2 d-none" />
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="saveEdit()">
              Save Changes
            </button>
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let editIndex = null;

      function renderProducts() {
        const table = document.getElementById("productTable");
        table.innerHTML = "";
        if (products.length === 0) {
          table.innerHTML = `<tr><td colspan="5" class="text-center">No products added yet.</td></tr>`;
          return;
        }

        products.forEach((product, index) => {
          table.innerHTML += `
        <tr>
          <td>${index + 1}</td>
          <td><img src="${product.image}" width="60"></td>
          <td>${product.name}</td>
          <td>â‚¦${parseFloat(product.price).toFixed(2)}</td>
          <td>
            <button class="btn btn-sm btn-warning me-1" onclick="editProduct(${index})">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-danger" onclick="deleteProduct(${index})">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `;
        });

        localStorage.setItem("products", JSON.stringify(products));
      }

      function previewImage(input) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            document.getElementById("imagePreview").src = e.target.result;
            document.getElementById("imagePreview").classList.remove("d-none");
          };
          reader.readAsDataURL(file);
        } else {
          document.getElementById("imagePreview").classList.add("d-none");
        }
      }

      function previewEditImage(input) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            document.getElementById("editImagePreview").src = e.target.result;
            document
              .getElementById("editImagePreview")
              .classList.remove("d-none");
          };
          reader.readAsDataURL(file);
        } else {
          document.getElementById("editImagePreview").classList.add("d-none");
        }
      }

      function addProduct() {
        const name = document.getElementById("name").value.trim();
        const price = parseFloat(document.getElementById("price").value.trim());
        const imageFile = document.getElementById("imageFile").files[0];

        if (!name || isNaN(price) || price <= 0 || !imageFile) {
          alert("Please fill all fields and select an image");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          const image = e.target.result;
          products.push({ name, price, image });
          renderProducts();

          document.getElementById("name").value = "";
          document.getElementById("price").value = "";
          document.getElementById("imageFile").value = "";
          document.getElementById("imagePreview").classList.add("d-none");
        };
        reader.readAsDataURL(imageFile);
      }

      function deleteProduct(index) {
        if (confirm("Are you sure you want to delete this product?")) {
          products.splice(index, 1);
          renderProducts();
        }
      }

      function editProduct(index) {
        editIndex = index;
        const product = products[index];
        document.getElementById("editName").value = product.name;
        document.getElementById("editPrice").value = product.price;
        document.getElementById("editImagePreview").src = product.image;
        document.getElementById("editImagePreview").classList.remove("d-none");

        const editModal = new bootstrap.Modal(
          document.getElementById("editModal")
        );
        editModal.show();
      }

      function saveEdit() {
        const name = document.getElementById("editName").value.trim();
        const price = parseFloat(
          document.getElementById("editPrice").value.trim()
        );
        const imageFile = document.getElementById("editImageFile").files[0];

        if (!name || isNaN(price) || price <= 0) {
          alert("Please enter valid name and price");
          return;
        }

        if (imageFile) {
          const reader = new FileReader();
          reader.onload = function (e) {
            products[editIndex].image = e.target.result;
            finishEdit(name, price);
          };
          reader.readAsDataURL(imageFile);
        } else {
          finishEdit(name, price);
        }
      }

      function finishEdit(name, price) {
        products[editIndex].name = name;
        products[editIndex].price = price;
        renderProducts();
        const editModal = bootstrap.Modal.getInstance(
          document.getElementById("editModal")
        );
        editModal.hide();

        // Clear modal inputs
        document.getElementById("editImageFile").value = "";
        document.getElementById("editImagePreview").classList.add("d-none");
      }

      renderProducts();
    </script>
  </body>
</html>
